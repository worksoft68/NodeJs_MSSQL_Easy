<%- include ('./../helpers/pagination') %>
<%
	const collection = "sys_Company";
	const linkPrefix = systemConfig.prefixAdmin + `/${collection}/`; 
%>
<%- include ('./../elements/notify') %>
<div class="container-fluid">
	<input name="linkPrefix" id="linkPrefix" type="hidden" value="<%= linkPrefix %>">
	<input name="params" id="params" type="hidden" value="<%= params %>">
	&nbsp; &nbsp; <button type="button" id="btnOpenMainModalForm" class="btn btn-primary">
		<i class="fas fa-plus"></i> Add new
	</button>
	&nbsp; <button type="button" id = "btnDelete" class="btn-sm btn-danger" title="Delete">
		<i class="fas fa-trash-alt"></i> Delete
	</button>
	&nbsp; <button type="button" id = "btnSearchPost_OpenForm" class="btn-sm btn-info" title="Search">
		<i class="fa fa-search"></i> Search
	</button>
	&nbsp; <button type="button" id = "btnExport_OpenForm" class="btn-sm btn-success" title="Export">
		<i class="fa fa-download"></i> Export
	</button>
	&nbsp; <button type="button" id="btnRefreshPage" class="btn-sm btn-warning" title="Refresh" onclick="RefreshPage()">
		<i class="fa fa-refresh"></i> Refresh
	</button>
	<!-- ================ Modal From ======================== -->
	<div class="modal fade" id="modaMainForm" data-backdrop="static" data-keyboard="true" tabindex="- 1"
		role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Add New & Edit</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
			<form role="form" name="formSys_Company" id="formSys_Company"  action =" <%= linkPrefix %>searchGet" method="get">
				<div class="form-group row">
					<label id="labCompanyId" class="col-sm-2 col-form-label text-sm-right ">Id</label>
					<div class="col-xs-2 col-sm-2">
						<input type="number" readonly name="CompanyId"  id="CompanyId" value="<%= item.CompanyId %>" class="form-control form-control-sm">
					</div>
					<label id="labCompanyName" class="col-sm-2 col-form-label text-sm-right required">Company Name</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="CompanyName"  id="CompanyName"  value="<%= item.CompanyName %>" class="form-control form-control-sm">
					</div>
					<label id="labAddress" class="col-sm-2 col-form-label text-sm-right ">Address</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="Address"  id="Address"  value="<%= item.Address %>" class="form-control form-control-sm">
					</div>
					<label id="labEmail1" class="col-sm-2 col-form-label text-sm-right ">Email</label>
					<div class="col-xs-2 col-sm-2">
						<input type="email" name="Email1"  id="Email1" value="<%= item.Email1 %>" class="form-control form-control-sm">
					</div>
					<label id="labPhoneNumber1" class="col-sm-2 col-form-label text-sm-right ">Phone Number</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="PhoneNumber1"  id="PhoneNumber1"  value="<%= item.PhoneNumber1 %>" class="form-control form-control-sm">
					</div>
					<label id="labNotes" class="col-sm-2 col-form-label text-sm-right ">Notes</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="Notes"  id="Notes"  value="<%= item.Notes %>" class="form-control form-control-sm">
					</div>
					<label id="labRepresentativeName" class="col-sm-2 col-form-label text-sm-right ">Representative Name</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="RepresentativeName"  id="RepresentativeName"  value="<%= item.RepresentativeName %>" class="form-control form-control-sm">
					</div>
					<label id="labLinkFaceBook" class="col-sm-2 col-form-label text-sm-right ">Link FaceBook</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="LinkFaceBook"  id="LinkFaceBook"  value="<%= item.LinkFaceBook %>" class="form-control form-control-sm">
					</div>
					<label id="labBankAccountNumber1" class="col-sm-2 col-form-label text-sm-right ">Bank Account Number</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="BankAccountNumber1"  id="BankAccountNumber1"  value="<%= item.BankAccountNumber1 %>" class="form-control form-control-sm">
					</div>
					<label id="labBankName1" class="col-sm-2 col-form-label text-sm-right ">Bank Name</label>
					<div class="col-xs-2 col-sm-2">
						<input type="text"  name="BankName1"  id="BankName1"  value="<%= item.BankName1 %>" class="form-control form-control-sm">
					</div>
					<label id="labStatus" class="col-sm-2 col-form-label text-sm-right ">Status</label>
					<div class="col-xs-2 col-sm-2">
						<input type="checkbox"  name="Status"  id="Status" class="form-control form-control-sm form-control-checkbox">
					</div>
				</div>
				<div class="form-group row">
					<div class = "text-success" id = "divMessage"></div>
				</div>
						<input name="CompanyIdHidden" id="CompanyIdHidden" type="hidden">
				<div class="modal-footer">
					&nbsp; <button type="button" id="btnCloseMainMoal" data-dismiss="modal"
						class="btn btn-sm btn-primary" title="Close">
						<i class="fa fa-mail-reply"></i> Close
					</button>
						<button type="button" id = "btnSave" class="btn-sm btn-success" title="Save">
							<i class="fa fa-save"></i> Save
						</button>
						 &nbsp; <button type="button" id = "btnSaveAs" class="btn-sm btn-danger" title="Save as">
							<i class="far fa-clone"></i> Save as
						</button>
						&nbsp; <button type="button" id = "btnUpdate" class="btn-sm btn-primary" title="Update">
							<i class="fa fa-save"></i> Update
						</button>
						&nbsp; <button type="button" id = "btnSearchPost" class="btn-sm btn-info" title="Search">
							<i class="fa fa-search"></i> Search
						</button>
						&nbsp; <button type="submit" id = "btnSearchGet" class="btn-sm btn-warning" title="Search Get">
							<i class="fa fa-search"></i> Search Get
						</button>
						&nbsp; <button type="button" id = "btnExport" class="btn-sm btn-success" title="Export">
							<i class="fa fa-download"></i> Export
						</button>
				</div>
			</form>
						<input name="listData" id="listData" type="hidden" value="<%= itemString %>">
						<input name="sysLanguage" id="sysLanguage" type="hidden" value="<%= language %>">
					<!-- // Underline -->
				<!--<div class="card card-info card-outline collapsed-card"></div>-->
			</div> <!-- End <div class="modal-body">  -->
		<!-- ================= Other information ==============================-->
		<div class="card card-info card-outline collapsed-card">
			<div class="card-header">
				<h6 class="card-title">Other information</h6>
				<div class="card-tools">
					<button type="button" class="btn btn-tool" data-card-widget="collapse"
						data-toggle="tooltip" title="Collapse">
						<i class="fas fa-plus"></i>
					</button>
				</div>
			</div>
			<div class="card-body" style="display: none;">
				<div class="row justify-content-between">
					<label class="col-sm-3 col-form-label text-sm-right" id="labUser_Name_Created_Text">User name created: </label>
					<label class="col-sm-3 col-form-label" id="labUser_Name_Created_Value">User name created: </label>
					<label class="col-sm-3 col-form-label text-sm-right" id="labDateTime_Created_Text">Datetime created: </label>
					<label class="col-sm-3 col-form-label" id="labDateTime_Created_Value">Datetime created:</label>
					<label class="col-sm-3 col-form-label text-sm-right" id="labUser_Name_Modified_Text">User name modifiedd: </label>
					<label class="col-sm-3 col-form-label" id="labUser_Name_Modified_Value">User name modifiedd: </label>
					<label class="col-sm-3 col-form-label text-sm-right" id="labDateTime_Modified_Text">DateTime modified: </label>
					<label class="col-sm-3 col-form-label" id="labDateTime_Modified_Value">DateTime modified: </label>
				</div>
			</div>
					
		</div>
		<!-- ================= End Other information ==================== -->
			</div> <!-- End <div class="modal-content">  -->
		</div>
	</div>
	<!-- ================ End Modal From ============================= -->

	<div class="card card-info card-outline">
		<div class="card-header">
			<h4 class="card-title">List data &nbsp;</h4>
			<!-- //===========================================-->
			<div class="button-group card-title">
				<button type="button" class="btn btn-default btn-sm dropdown-toggle"
					data-toggle="dropdown">
					<span class="fas fa-cog"></span>
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu" style="width: 300px;">
					<li>
						<a href="#" class="small" data-value="CompanyId" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnCompanyId" />&nbsp;
							<label id="labCompanyId_CheckboxShow">Id </label>
						</a> &nbsp; &nbsp;
						<a href="#" class="small" data-value="CompanyName" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnCompanyName" />&nbsp;
							<label id="labCompanyName_CheckboxShow">Company Name </label>
						</a>
					</li>
					<li>
						<a href="#" class="small" data-value="Address" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnAddress" />&nbsp;
							<label id="labAddress_CheckboxShow">Address </label>
						</a> &nbsp; &nbsp;
					</li>
					<li>
						<a href="#" class="small" data-value="Email1" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnEmail1" />&nbsp;
							<label id="labEmail1_CheckboxShow">Email </label>
						</a> &nbsp; &nbsp;
					</li>
					<li>
						<a href="#" class="small" data-value="PhoneNumber1" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnPhoneNumber1" />&nbsp;
							<label id="labPhoneNumber1_CheckboxShow">Phone Number </label>
						</a> &nbsp; &nbsp;
					</li>
					<li>
						<a href="#" class="small" data-value="Notes" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnNotes" />&nbsp;
							<label id="labNotes_CheckboxShow">Notes </label>
						</a> &nbsp; &nbsp;
					</li>
					<li>
						<a href="#" class="small" data-value="RepresentativeName" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnRepresentativeName" />&nbsp;
							<label id="labRepresentativeName_CheckboxShow">Representative Name </label>
						</a> &nbsp; &nbsp;
						<a href="#" class="small" data-value="LinkFaceBook" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnLinkFaceBook" />&nbsp;
							<label id="labLinkFaceBook_CheckboxShow">Link FaceBook </label>
						</a>
					</li>
					<li>
						<a href="#" class="small" data-value="BankAccountNumber1" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnBankAccountNumber1" />&nbsp;
							<label id="labBankAccountNumber1_CheckboxShow">Bank Account Number </label>
						</a> &nbsp; &nbsp;
						<a href="#" class="small" data-value="BankName1" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnBankName1" />&nbsp;
							<label id="labBankName1_CheckboxShow">Bank Name </label>
						</a>
					</li>
					<li>
						<a href="#" class="small" data-value="Status" tabIndex="-1">
							<input type="checkbox" id="ckhShowColumnStatus" />&nbsp;
							<label id="labStatus_CheckboxShow">Status </label>
						</a> &nbsp; &nbsp;
					</li>
				</ul>
			</div>
			<!-- //=========================================================== -->
			<div class="card-tools">
				<button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="fas fa-minus"></i></button>
			</div>
		</div>
		<div class="card-body">
			<table id="tableSys_Company" class="table table-bordered table-hover btn-table mb-0">
				<thead>
					<tr>
						<th class="text-center">
							<div class="custom-control custom-checkbox">
								<input class="custom-control-input cbAll" type="checkbox" id="check-all">
								<label for="check-all" class="custom-control-label"></label>
							</div>
						</th>
						<th class="text-center" data-sort="" data-column="CompanyId" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labCompanyId_tb">
								Id <i class="fa fa-fw" data-column="CompanyId"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="CompanyName" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labCompanyName_tb">
								Company Name <i class="fa fa-fw" data-column="CompanyName"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="Address" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labAddress_tb">
								Address <i class="fa fa-fw" data-column="Address"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="Email1" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labEmail1_tb">
								Email <i class="fa fa-fw" data-column="Email1"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="PhoneNumber1" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labPhoneNumber1_tb">
								Phone Number <i class="fa fa-fw" data-column="PhoneNumber1"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="Notes" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labNotes_tb">
								Notes <i class="fa fa-fw" data-column="Notes"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="RepresentativeName" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labRepresentativeName_tb">
								Representative Name <i class="fa fa-fw" data-column="RepresentativeName"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="LinkFaceBook" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labLinkFaceBook_tb">
								Link FaceBook <i class="fa fa-fw" data-column="LinkFaceBook"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="BankAccountNumber1" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labBankAccountNumber1_tb">
								Bank Account Number <i class="fa fa-fw" data-column="BankAccountNumber1"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="BankName1" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labBankName1_tb">
								Bank Name <i class="fa fa-fw" data-column="BankName1"></i>
							</label>
						</th>
						<th class="text-center" data-sort="" data-column="Status" class="columnHeader" onclick="sortByColumn(this)">
							<label id="labStatus_tb">
								Status <i class="fa fa-fw" data-column="Status"></i>
							</label>
						</th>
						<th class="text-center">Action</a></th>
					</tr>
				</thead>
				<tbody id="bodyTableSys_Company">
					<tr>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
						<th class="text-center"></a></th>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<div class="form-group row">
		<div class="col-xs-1 col-sm-1">Quantity per page:</div>
		<div class="col-xs-1 col-sm-1">
			<input type="number" class="form-control form-control-sm" name="numberItemPerPage" id="numberItemPerPage" size="4">
		</div>
		<div class="col-xs-9 col-sm-9" id="paginationSys_Company">
		</div>
	</div>
</div>
<script type="application/javascript">
var language = {};
var listData;
var linkPrefix=$('#linkPrefix').val();
var idMainTable="tableSys_Company";
setSelectedColumnToShowInterface(idMainTable);

onLoadData();
function onLoadData(){
	getLanguage();
	setUpdateButtonStatus(false)
	setInterfaceText();
	getNumberItemPerPage();
	var strData = $('#listData').val();
	listData = JSON.parse(strData);
	if(listData.length>0){
		displayDataToTable();
		var paramsString = $('#params').val();
		const params = JSON.parse(paramsString);
		paginationHelper(params.pagination, "Sys_Company", params.currentStatus, params.keyword,linkPrefix,  "paginationSys_Company");
	}
}

function displayDataToTable(){
	sortDataJson();
	showAllColumnInTable(idMainTable);
	var table = document.getElementById("bodyTableSys_Company");
	var lengthtable= table.rows.length-1;
	for(var n = lengthtable; n >= 0; n--) {
		table.deleteRow(n);
	}
	var length = listData.length;
	if(length <1 ) {
		showNoticeDanger(language.Message_NotFoundData);
		return false;
	}
	$("#modaMainForm").modal('hide');
	listData.forEach(function(data) {
		var row = table.insertRow(0);
		var cell0 = row.insertCell(0);
		var cell1 = row.insertCell(1);
		var cell2 = row.insertCell(2);
		var cell3 = row.insertCell(3);
		var cell4 = row.insertCell(4);
		var cell5 = row.insertCell(5);
		var cell6 = row.insertCell(6);
		var cell7 = row.insertCell(7);
		var cell8 = row.insertCell(8);
		var cell9 = row.insertCell(9);
		var cell10 = row.insertCell(10);
		var cell11 = row.insertCell(11);
		var cell12 = row.insertCell(12);
		let check= `<div class="custom-control custom-checkbox"> 
				<input class="custom-control-input" type="checkbox" name="chkListData" id="${data.CompanyId}" value="${data.CompanyId}">
				<label for="${data.CompanyId}" class="custom-control-label"></label>
			</div>`;
		cell0.innerHTML = check;
		cell1.innerHTML = data.CompanyId;
		cell2.innerHTML = data.CompanyName;
		cell3.innerHTML = data.Address;
		cell4.innerHTML = data.Email1;
		cell5.innerHTML = data.PhoneNumber1;
		cell6.innerHTML = data.Notes;
		cell7.innerHTML = data.RepresentativeName;
		cell8.innerHTML = data.LinkFaceBook;
		cell9.innerHTML = data.BankAccountNumber1;
		cell10.innerHTML = data.BankName1;
		cell11.innerHTML = data.Status;
		let strbutton = " <a  onclick=\"getById('"+data.CompanyId+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">" +
			"<i class=\"fas fa-pencil-alt\"></i>" + 
			"</a> " + 
			" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data.CompanyId+"\" title=\"Delete\"  onclick=\"deleteById(this,"+data.CompanyId+",'" + data.CompanyName + "')\">";
			strbutton += " <i class=\"fas fa-trash-alt\"></i> ";
		strbutton += " </ button > ";
		cell12.innerHTML = strbutton;
	});
	hideColumnInTable(idMainTable);
}
function setUpdateButtonStatus(statusUpdate){	
	$('#btnSave').prop('hidden', statusUpdate);
	$('#btnUpdate').prop('hidden', !statusUpdate);
}

function getLanguage(){
	var languageString = $('#sysLanguage').val();	
	language = JSON.parse(languageString);
}

function setInterfaceText(){
	$("#pageTitle").html(language.TitlePage);
	$("#labCompanyId").text(language.CompanyId);
	$("#labCompanyName").text(language.CompanyName);
	$("#labAddress").text(language.Address);
	$("#labEmail1").text(language.Email1);
	$("#labPhoneNumber1").text(language.PhoneNumber1);
	$("#labNotes").text(language.Notes);
	$("#labRepresentativeName").text(language.RepresentativeName);
	$("#labLinkFaceBook").text(language.LinkFaceBook);
	$("#labBankAccountNumber1").text(language.BankAccountNumber1);
	$("#labBankName1").text(language.BankName1);
	$("#labStatus").text(language.Status);

	$("#labCompanyId_tb").html(language.CompanyId+"<i class=\"fa fa-fw\" data-column=\"CompanyId\"></i>");
	$("#labCompanyName_tb").html(language.CompanyName+"<i class=\"fa fa-fw\" data-column=\"CompanyName\"></i>");
	$("#labAddress_tb").html(language.Address+"<i class=\"fa fa-fw\" data-column=\"Address\"></i>");
	$("#labEmail1_tb").html(language.Email1+"<i class=\"fa fa-fw\" data-column=\"Email1\"></i>");
	$("#labPhoneNumber1_tb").html(language.PhoneNumber1+"<i class=\"fa fa-fw\" data-column=\"PhoneNumber1\"></i>");
	$("#labNotes_tb").html(language.Notes+"<i class=\"fa fa-fw\" data-column=\"Notes\"></i>");
	$("#labRepresentativeName_tb").html(language.RepresentativeName+"<i class=\"fa fa-fw\" data-column=\"RepresentativeName\"></i>");
	$("#labLinkFaceBook_tb").html(language.LinkFaceBook+"<i class=\"fa fa-fw\" data-column=\"LinkFaceBook\"></i>");
	$("#labBankAccountNumber1_tb").html(language.BankAccountNumber1+"<i class=\"fa fa-fw\" data-column=\"BankAccountNumber1\"></i>");
	$("#labBankName1_tb").html(language.BankName1+"<i class=\"fa fa-fw\" data-column=\"BankName1\"></i>");
	$("#labStatus_tb").html(language.Status+"<i class=\"fa fa-fw\" data-column=\"Status\"></i>");

	$("#labCompanyId_CheckboxShow").text(language.CompanyId);
	$("#labCompanyName_CheckboxShow").text(language.CompanyName);
	$("#labAddress_CheckboxShow").text(language.Address);
	$("#labEmail1_CheckboxShow").text(language.Email1);
	$("#labPhoneNumber1_CheckboxShow").text(language.PhoneNumber1);
	$("#labNotes_CheckboxShow").text(language.Notes);
	$("#labRepresentativeName_CheckboxShow").text(language.RepresentativeName);
	$("#labLinkFaceBook_CheckboxShow").text(language.LinkFaceBook);
	$("#labBankAccountNumber1_CheckboxShow").text(language.BankAccountNumber1);
	$("#labBankName1_CheckboxShow").text(language.BankName1);
	$("#labStatus_CheckboxShow").text(language.Status);
}

function getById(Id){
	var link = linkPrefix + 'getById/'+Id;
	$.ajax({
		type: 'GET',
		url: link,
		dataType: "json",
		success: function(resultdata){
			var success = resultdata.success;
			if(success == true){
				showDataToForm(resultdata.data);
			}
		},
		failure: function (response) {
			alert(language.Message_GetItemByIdError);
		},
		error: function (response) {
			alert(language.Message_GetItemByIdError);
		},
	});
}

function showDataToForm(data){
	try{
		setUpdateButtonStatus(true);
		$("#modaMainForm").modal('show');
		$('#CompanyIdHidden').val(data.CompanyId);
		$('#CompanyId').val(data.CompanyId);
		$('#CompanyName').val(data.CompanyName);
		$('#Address').val(data.Address);
		$('#Email1').val(data.Email1);
		$('#PhoneNumber1').val(data.PhoneNumber1);
		$('#Notes').val(data.Notes);
		$('#RepresentativeName').val(data.RepresentativeName);
		$('#LinkFaceBook').val(data.LinkFaceBook);
		$('#BankAccountNumber1').val(data.BankAccountNumber1);
		$('#BankName1').val(data.BankName1);
		if((data.Status == "true") || (data.Status == true) || (data.Status == "active")|| (data.Status == "yes")|| (data.Status == "1"))
			$("#Status").prop("checked", true);
		else $("#Status").prop("checked", false);

			$('#labUser_Name_Created_Value').text(data.User_Name_Created);
			$('#labDateTime_Created_Value').text(data.DateTime_Created);
		$('#labUser_Name_Modified_Value').text(data.User_Name_Modified);
		$('#labDateTime_Modified_Value').text(data.DateTime_Modified);
	}
	catch(error){}
}

$('#btnOpenMainModalForm').click(function () {
	$("#modaMainForm").modal('show');
	clearForm();
});

$('#btnSearchPost_OpenForm').click(function(){
	$("#modaMainForm").modal('show');
});

$('#btnExport_OpenForm').click(function(){
	$("#modaMainForm").modal('show');
});

function clearForm(){
	try{
		$('#CompanyIdHidden').val('');
		setUpdateButtonStatus(false)
		$('#CompanyId').val('');
		$('#CompanyName').val('');
		$('#Address').val('');
		$('#Email1').val('');
		$('#PhoneNumber1').val('');
		$('#Notes').val('');
		$('#RepresentativeName').val('');
		$('#LinkFaceBook').val('');
		$('#BankAccountNumber1').val('');
		$('#BankName1').val('');
	}
	catch(error){}
}

$('#btnSearchPost').click(function(){
	$(this).prop('disabled', true);
	getContentPages(1);
});

function getContentPages(page){
	var sortStorage=getSortType(linkPrefix);
	let data = {
		CompanyName : $('#CompanyName').val(),
		Address : $('#Address').val(),
		Email1 : $('#Email1').val(),
		PhoneNumber1 : $('#PhoneNumber1').val(),
		Notes : $('#Notes').val(),
		RepresentativeName : $('#RepresentativeName').val(),
		LinkFaceBook : $('#LinkFaceBook').val(),
		BankAccountNumber1 : $('#BankAccountNumber1').val(),
		BankName1 : $('#BankName1').val(),
		Page : page,
		sortColumn: sortStorage.sortColumn,
		sortType: sortStorage.sortType,
		numberItemPerPage: $('#numberItemPerPage').val()
	}
	var link = linkPrefix + 'search';
	$.ajax({
		type: 'POST',
		url: link,
		data: data,
		dataType: "json",
		success: function(resultdata){
			$('#btnSearchPost').prop('disabled', false);
			listData = resultdata.data;
			displayDataToTable();
			let params = resultdata.params;
			paginationHelper(params.pagination, "Sys_Company", "", "", linkPrefix, "paginationSys_Company");

			if(params.pagination.totalItems > 0 ) {
				var message = language.Message_Find + params.pagination.totalItems + language.Message_Words_records;
				showNoticeSuccess(message);
			}
		},
		failure: function (response) {
			$('#btnSearchPost').prop('disabled', false);
			showNoticeDanger('Search Error');
		},
		error: function (response) {
			$('#btnSearchPost').prop('disabled', false);
			showNoticeDanger('Search Error');
		}
	});
	$('#btnSearchPost').prop('disabled', false);
}

$('#btnSave').click(function(){
	$(this).prop('disabled', true);
	saveInsert();
});

$('#btnSaveAs').click(function(){
	$(this).prop('disabled', true);
	$('#CompanyIdHidden').val('');
	$('#CompanyId').val('');
	saveInsert();
	$(this).prop('disabled', false);
});

function chekValueAndSubmit(){
	if(($('#CompanyName').val().length < 1) || ($('#CompanyName').val().length > 200)) {
		var message = formatMessage(language.CompanyName + ": "+ language.Message_Invalid_CompanyName, '1','200');
		alert(message);
		return false;
	}
	let Status= $('#Status').is(":checked")? "true":"false";
	$('#Status').val(Status);
	document.getElementById("formSys_Company").submit();
}

function getDataForm(){
	if(($('#CompanyName').val().length < 1) || ($('#CompanyName').val().length > 200)) {
		var message = formatMessage(language.CompanyName + ": "+ language.Message_Invalid_CompanyName, '1','200');
		alert(message);
		return false;
	}
	return {
		'CompanyIdHidden' : $('#CompanyIdHidden').val(),
		'CompanyId' : $('#CompanyId').val(),
		'CompanyName' : $('#CompanyName').val(),
		'Address' : $('#Address').val(),
		'Email1' : $('#Email1').val(),
		'PhoneNumber1' : $('#PhoneNumber1').val(),
		'Notes' : $('#Notes').val(),
		'RepresentativeName' : $('#RepresentativeName').val(),
		'LinkFaceBook' : $('#LinkFaceBook').val(),
		'BankAccountNumber1' : $('#BankAccountNumber1').val(),
		'BankName1' : $('#BankName1').val(),
		'Status' : $('#Status').is (":checked"),
	}
}

function saveInsert(){
	let data = getDataForm();
	if(data == false) {
		$('#btnSave').prop('disabled', false);
		return false;
	}
	var link = linkPrefix + 'save';
	$.ajax({
		type: 'post',
		url: link,
		data: data,
		dataType: "json",
		success: function(response){
			var success = response.success;
			var result 	= response.data;
			if((success == 'false') || (success == false))
				showNoticeDanger(language.Message_AddNewError + ' ('+response.message+')');
			else if((success != true) && (success != 'true'))
				showNoticeDanger(result.message);
			else {
				insertRow(result.data);
				clearForm();
			}
		},
		failure: function (response) {
			showErrorMessageSave(response, language.Message_AddNewError);
		},
		error: function (response) {
			showErrorMessageSave(response, language.Message_AddNewError);
		},
	});
	$('#btnSave').prop('disabled', false);
}

function insertRow(data){
	showAllColumnInTable(idMainTable);
	showNoticeSuccess(language.Message_AddNewSuccess);
	var table = document.getElementById("bodyTableSys_Company");
	var row = table.insertRow(0);
	var cell0 = row.insertCell(0);
	var cell1 = row.insertCell(1);
	var cell2 = row.insertCell(2);
	var cell3 = row.insertCell(3);
	var cell4 = row.insertCell(4);
	var cell5 = row.insertCell(5);
	var cell6 = row.insertCell(6);
	var cell7 = row.insertCell(7);
	var cell8 = row.insertCell(8);
	var cell9 = row.insertCell(9);
	var cell10 = row.insertCell(10);
	var cell11 = row.insertCell(11);
	var cell12 = row.insertCell(12);
	let check= `<div class="custom-control custom-checkbox"> 
					<input class="custom-control-input" type="checkbox" name="chkListData" id="${data.CompanyId}" value="${data.CompanyId}">
					<label for="${data.CompanyId}" class="custom-control-label"></label>
				</div>`;
	cell0.innerHTML = check;
	cell1.innerHTML = data.CompanyId;
	cell2.innerHTML = data.CompanyName;
	cell3.innerHTML = data.Address;
	cell4.innerHTML = data.Email1;
	cell5.innerHTML = data.PhoneNumber1;
	cell6.innerHTML = data.Notes;
	cell7.innerHTML = data.RepresentativeName;
	cell8.innerHTML = data.LinkFaceBook;
	cell9.innerHTML = data.BankAccountNumber1;
	cell10.innerHTML = data.BankName1;
	cell11.innerHTML = data.Status;
	let strbutton = " <a  onclick=\"getById('"+data.CompanyId+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">" +
		"<i class=\"fas fa-pencil-alt\"></i>" + 
		"</a> " + 
		" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data.CompanyId+"\" title=\"Delete\"  onclick=\"deleteById(this,"+data.CompanyId+",'" + data.CompanyName + "')\">";
	strbutton += " <i class=\"fas fa-trash-alt\"></i> ";
	strbutton += " </ button > ";
	cell12.innerHTML = strbutton;
	hideColumnInTable(idMainTable);
}

$('#btnUpdate').click(function(){
	$(this).prop('disabled', true);
	saveUpdate();
});

function saveUpdate(){
	let data = getDataForm();
	if(data == false) {
		$('#btnUpdate').prop('disabled', false);
		return false;
	}
	if(data.CompanyIdHidden == ""){
		$('#btnUpdate').prop('disabled', false);
		showNoticeDanger(language.Message_HaveNotSelectedItemUpdate);
		return false;
	}
	var link = linkPrefix + 'update';
	$.ajax({
		type: 'put',
		url: link,
		data: data,
		dataType: "json",
		success: function(response){
			var success = response.success;
			var result 	= response.data;
			if((success == 'false') || (success == false) ){
				showNoticeDanger(language.Message_UpdateError);
				return false;
			}
			else if((success != true) && (success != 'true')){
				showNoticeDanger(result.message);
				return false;
			}
			else {
				updateRow(result.data);
				clearForm();
			}
		},
		failure: function (response) {
			showErrorMessageSave(response, language.Message_UpdateError);
		},
		error: function (response) {
			showErrorMessageSave(response, language.Message_UpdateError);
		}
	});
	$('#btnUpdate').prop('disabled', false);
}

function updateRow(data){
	showNoticeSuccess(language.Message_UpdateSuccess);
	showAllColumnInTable(idMainTable);
	$("#modaMainForm").modal('hide');
	var row = $("#tableSys_Company button[data-id='" + data.CompanyId + "']").parents("tr")[0];
	var tr = "<tr>"+
		"<td class=\"text-center\">" +
			"<div class=\"custom-control custom-checkbox\">"+ 
				"<input class=\"custom-control-input\" type=\"checkbox\" name=\"chkListData\" id=\"" + data.CompanyId + "\" value=\"" + data.CompanyId + "\"> "+
				"<label for=\"" + data.CompanyId + "\" class=\"custom-control-label\"></label> "+
			"</div>"+
		"</td>";
		tr +=  "<td class=\"text-center\">" + data.CompanyId + "</td>";
		tr +=  "<td class=\"text-center\">" + data.CompanyName + "</td>";
		tr +=  "<td class=\"text-center\">" + data.Address + "</td>";
		tr +=  "<td class=\"text-center\">" + data.Email1 + "</td>";
		tr +=  "<td class=\"text-center\">" + data.PhoneNumber1 + "</td>";
		tr +=  "<td class=\"text-center\">" + data.Notes + "</td>";
		tr +=  "<td class=\"text-center\">" + data.RepresentativeName + "</td>";
		tr +=  "<td class=\"text-center\">" + data.LinkFaceBook + "</td>";
		tr +=  "<td class=\"text-center\">" + data.BankAccountNumber1 + "</td>";
		tr +=  "<td class=\"text-center\">" + data.BankName1 + "</td>";
		tr +=  "<td class=\"text-center\">" + data.Status + "</td>";
		tr += "<td class=\"text-center\">" +
			" <a  onclick=\"getById('"+data.CompanyId+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">" +
				" <i class=\"fas fa-pencil-alt\"></i>" +
			" </a>" +
			" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data.CompanyId+"\" title=\"Delete\"  onclick=\"deleteById(this,'"+data.CompanyId+"','"+data.CompanyName+"')\">" +
				" <i class=\"fas fa-trash-alt\"></i> " +
			" </button> " +
		" </td>" +
	" </tr>";
	$(row).after(tr);
	$(row).remove();
	hideColumnInTable(idMainTable);
}
function deleteById(row, objectId, objectName){
	var message=language.Message_DoYouWantToDeleteById + ' '+ objectId +' ('+objectName+')? ';
	var answer = confirm(message)
	if (!answer){	return false; } 
	let data = {
		'CompanyId' : objectId
	};
	var link = linkPrefix+'deleteById';
	$.ajax({
		type	: 'delete',
		url		: link,
		data	: data,
		dataType: "json",
		success	: function(resultdata){
			var success = resultdata.success;
			var message = resultdata.message;
			var notice 	= {};
			if((success == 'true') || (success == true)){
				showNoticeSuccess(language.Message_DeleteSuccess);
				var i = row.parentNode.parentNode.rowIndex;
				document.getElementById("tableSys_Company").deleteRow(i);
				return true;
			}
			else if((success=='false')||(success==false)) {
				showNoticeDanger(language.Message_DeleteFail);
				return false;
			}
			else if(message.length > 10){
				showNoticeDanger(message);
				return false;
			}
			else {
				showNoticeDanger(language.Message_DeleteFail);
				return false;
			}
		},
		failure: function (response) {
			showNoticeDanger(language.Message_DeleteFail);
		},
		error: function (response) {
			showNoticeDanger(language.Message_DeleteFail);
		}
	});
}

$('#btnDelete').click(function(){
	$(this).prop('disabled', true);
	deleteList();
	$(this).prop('disabled', false);
});
function deleteList(){
	var arrayId = [];
	var listId 	= " ";
	$("input:checkbox[name=chkListData]:checked").each(function(){
		arrayId.push($(this).val());
		listId += $(this).val() + ',';
	});
	let message =  language.Message_DoYouWantToDeleteInTheList  +' '+ listId+'?';
	var answer = confirm(message)
	if (!answer){	return false; } 
	let data = { arrayId };
	var link = linkPrefix+'deleteList';
	$.ajax({
		type	: 'delete',
		url		: link,
		data	: data,
		dataType: "json",
		success	: function(resultdata){
			var result = resultdata.data;
			var success = result.success;
			var message = result.message;
			if((success == 'true') || (success == true)){
				let deleteSuccess = result.deleteSuccess;
				let deleteError = result.deleteError;
				if(deleteSuccess.length > 0){
					let message = language.Message_DeleteSuccess;
					message += " "+ deleteSuccess.toString();
					if(deleteError.length > 0){
						message += " \n"+  language.Message_DeleteFail + " "+ deleteError.toString();
					}
					showNoticeSuccess(message);
					deleteRows(arrayId,"bodyTableSys_Company");
					return true;
				}
				else if(deleteError.length > 0){
					let message = language.Message_DeleteFail + " "+ deleteError.toString();
					showNoticeDanger(message);
				}
				else{
					showNoticeDanger(language.Message_DeleteFail);
				}
			}
			else if((success == 'false') || (success == false)){
				showNoticeDanger(language.Message_DeleteFail);
				return false;
			}
		},
		failure: function (response) {
			showNoticeDanger(language.Message_DeleteFail);
		},
		error: function (response) {
			showNoticeDanger(language.Message_DeleteFail);
		}
	});
}

$('#btnExport').click(function(){
	$(this).prop('disabled', true);
	exportData();
	$(this).prop('disabled', false);
});

function exportData(){
	let data = {
		'CompanyName' : $('#CompanyName').val(),
		'Address' : $('#Address').val(),
		'Email1' : $('#Email1').val(),
		'PhoneNumber1' : $('#PhoneNumber1').val(),
		'Notes' : $('#Notes').val(),
		'RepresentativeName' : $('#RepresentativeName').val(),
		'LinkFaceBook' : $('#LinkFaceBook').val(),
		'BankAccountNumber1' : $('#BankAccountNumber1').val(),
		'BankName1' : $('#BankName1').val(),
	}
	var link = linkPrefix + 'exportData';
	$.ajax({
		type: 'post',
		url: link,
		data: data,
		dataType: "json",
		success: function(resultdata){
			$('#btnExport').prop('disabled', false);
			let result = resultdata.data;
			showNoticeSuccess(language.Message_CompletedGetData);
			ExportToExcel(result);
		},
		failure: function (response) {
			$('#btnExport').prop('disabled', false);
			showNoticeDanger('Export Error');
		},
		error: function (response) {
			$('#btnExport').prop('disabled', false);
			showNoticeDanger('Export Error');
		}
	});
	$('#btnExport').prop('disabled', false);
}

function ExportToExcel(datas){
	let itemCount = datas.length; 
	if(itemCount > 1000) {
		showNoticeDanger(language.Message_WarningWhenExportingDataTooMuch);
	}
	if(itemCount < 1) {
		showNoticeDanger(language.Message_NotFoundData);
	}
	var strTable = '<style type="text/css">';
	strTable += ' .Border { ';
	strTable += '         color: windowtext; ';
	strTable += '         font-size: 11.0pt; ';
	strTable += '         word-break:break-all;';
	strTable += '         font-style: normal; ';
	strTable += '         text-decoration: none; ';
	strTable += '         font-family: "Times New Roman", serif; ';
	strTable += '         text-align: left; ';
	strTable += '         vertical-align: bottom;';
	strTable += '         border-left: .5pt solid windowtext; ';
	strTable += '         border-right: .5pt solid windowtext; ';
	strTable += '         border-top: .5pt solid windowtext; ';
	strTable += '         border-bottom: .5pt solid windowtext; ';
	strTable += '         padding-left: 1px; ';
	strTable += '         padding-right: 1px; ';
	strTable += '         padding-top: 1px; ';
	strTable += '     } ';

	strTable += ' .BorderHeader { ';
	strTable += '        color: white; ';
	strTable += '         background-color:#0026ff; ';
	strTable += '        font-size: 11.0pt; ';
	strTable += '        text-align: center; ';
	strTable += '        font-style: normal; ';
	strTable += '        text-decoration: none; ';
	strTable += '        font-family: "Times New Roman", serif; ';
	strTable += '        vertical-align: bottom;';
	strTable += '        border-left: .5pt solid windowtext; ';
	strTable += '        border-right: .5pt solid windowtext; ';
	strTable += '        border-top: .5pt solid windowtext; ';
	strTable += '        border-bottom: .5pt solid windowtext; ';
	strTable += '        padding-left: 1px; ';
	strTable += '        padding-right: 1px; ';
	strTable += '        padding-top: 1px; ';
	strTable += '     } ';
	strTable += '  </style> ';
	strTable += ' <table id="testTable"  border="1" frame="hsides" rules="groups" summary="Code page support in different versions of MS Windows."> ';
	strTable += '<tr class="BorderHeader" style="background - color:#0026ff; color:#fff"> ';
	strTable += '<th class="BorderHeader" >Order</th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Id </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Company Name </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Address </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Email </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Phone Number </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Notes </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Representative Name </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Link FaceBook </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Bank Account Number </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Bank Name </th> ';
	strTable += '<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Status </th> ';
	strTable += '</tr> ';
	var n = 0;
	var currentRow = 4;
	for(var i = 0; i < itemCount; i++) {
		var vTemp = datas[i];
		currentRow += 1;
		 n += 1;
		strTable += '<tr >';
		strTable += '<th class="Border" > ' + n + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.CompanyId + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.CompanyName + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.Address + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.Email1 + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.PhoneNumber1 + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.Notes + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.RepresentativeName + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.LinkFaceBook + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.BankAccountNumber1 + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.BankName1 + ' </th> ';
		 strTable += '<th  class="Border" > ' + vTemp.Status + ' </th> ';
		strTable += '</tr>';
	}
	strTable += ' </table> ';
	ExportHtmlToExcel(strTable, 'Sys_Company');
	showNoticeSuccess(language.Message_ExportSuccess);
}

</script>
