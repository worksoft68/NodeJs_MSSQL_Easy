<%- include ('./../helpers/pagination') %>
	<% const collection="sys_User" ; const linkPrefix=systemConfig.prefixAdmin + `/${collection}/`; %>
		<%- include ('./../elements/notify') %>

			<script src="admin/js/sha1.js"></script>

			<div class="container-fluid">
				<input name="linkPrefix" id="linkPrefix" type="hidden" value="<%= linkPrefix %>">
				<input name="params" id="params" type="hidden" value="<%= params %>">
				<div class="card card-info card-outline">
					<div class="card-header">
						<h6 class="card-title">Form</h6>
						<div class="card-tools">
							<button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip"
								title="Collapse">
								<i class="fas fa-minus"></i>
							</button>
						</div>
					</div>
					<div class="card-body" style="display: block;">
						<form action=" <%= linkPrefix %>searchGet" method="GET">
							<div class="form-group row">
								<label id="labUsersId" class="col-sm-2 col-form-label text-sm-right ">UsersId</label>
								<div class="col-xs-2 col-sm-2">
									<input type="number" readonly name="UsersId" id="UsersId"
										value="<%= item.UsersId %>" class="form-control form-control-sm">
								</div>
								<label id="labEmployeeCode"
									class="col-sm-2 col-form-label text-sm-right required">EmployeeCode</label>
								<div class="col-xs-2 col-sm-2">
									<input type="text" name="EmployeeCode" id="EmployeeCode"
										value="<%= item.EmployeeCode %>" class="form-control form-control-sm">
								</div>
								<label id="labCompanyId"
									class="col-sm-2 col-form-label text-sm-right required">Company</label>
								<div class="col-xs-2 col-sm-2">
									<div class="dropdown">
										<div id="divDropdownCompanyName" class="dropdown-content">
											<input type="text" id="CompanyName" name="CompanyName"
												onkeyup="filterSelectBox('CompanyName')"
												onfocus="focusDropdown('CompanyName')"
												onblur="blurDropdown('CompanyName')"
												class="form-control form-control-sm">
											<input id="CompanyId" name="CompanyId" type="hidden">
											<div id="DivContenCompanyName" class="Divdropdown-content">
											</div>
										</div>
									</div>
								</div>
								<label id="labDepartmentId"
									class="col-sm-2 col-form-label text-sm-right required">Department</label>
								<div class="col-xs-2 col-sm-2">
									<div class="dropdown">
										<div id="divDropdownDepartmentName" class="dropdown-content">
											<input type="text" id="DepartmentName" name="DepartmentName"
												onkeyup="filterSelectBox('DepartmentName')"
												onfocus="focusDropdown('DepartmentName')"
												onblur="blurDropdown('DepartmentName')"
												class="form-control form-control-sm">
											<input id="DepartmentId" name="DepartmentId" type="hidden">
											<div id="DivContenDepartmentName" class="Divdropdown-content">
											</div>
										</div>
									</div>
								</div>
								<label id="labPositionId"
									class="col-sm-2 col-form-label text-sm-right required">Position</label>
								<div class="col-xs-2 col-sm-2">
									<div class="dropdown">
										<div id="divDropdownPositionName" class="dropdown-content">
											<input type="text" id="PositionName" name="PositionName"
												onkeyup="filterSelectBox('PositionName')"
												onfocus="focusDropdown('PositionName')"
												onblur="blurDropdown('PositionName')"
												class="form-control form-control-sm">
											<input id="PositionId" name="PositionId" type="hidden">
											<div id="DivContenPositionName" class="Divdropdown-content">
											</div>
										</div>
									</div>
								</div>
								<label id="labLastName"
									class="col-sm-2 col-form-label text-sm-right required">LastName</label>
								<div class="col-xs-2 col-sm-2">
									<input type="text" name="LastName" id="LastName" value="<%= item.LastName %>"
										class="form-control form-control-sm">
								</div>
								<label id="labFirstName"
									class="col-sm-2 col-form-label text-sm-right required">FirstName</label>
								<div class="col-xs-2 col-sm-2">
									<input type="text" name="FirstName" id="FirstName" value="<%= item.FirstName %>"
										class="form-control form-control-sm">
								</div>
								<label id="labUserName"
									class="col-sm-2 col-form-label text-sm-right required">UserName</label>
								<div class="col-xs-2 col-sm-2">
									<input type="text" name="UserName" id="UserName" autocomplete="new-password"
										value="<%= item.UserName %>" class="form-control form-control-sm">
								</div>
								<label id="labPassword"
									class="col-sm-2 col-form-label text-sm-right required">Password</label>
								<div class="col-xs-2 col-sm-2">
									<input type="text" name="Password" id="Password" autocomplete="new-password"
										class="form-control form-control-sm">
								</div>
								<label id="labSex" class="col-sm-2 col-form-label text-sm-right required">Sex</label>
								<div class="col-xs-2 col-sm-2">
									<select name="Sex" id="Sex" class="form-control form-control-sm">
										<option value="Other">Choose</option>
										<option value="Male">Male</option>
										<option value="Female">Female</option>
										<option value="Other">Other</option>
									</select>
								</div>
								<label id="labEmail" class="col-sm-2 col-form-label text-sm-right ">Email</label>
								<div class="col-xs-2 col-sm-2">
									<input type="email" name="Email" id="Email" value="<%= item.Email %>"
										class="form-control form-control-sm">
								</div>
								<label id="labPhoneNumber"
									class="col-sm-2 col-form-label text-sm-right ">PhoneNumber</label>
								<div class="col-xs-2 col-sm-2">
									<input type="text" name="PhoneNumber" id="PhoneNumber"
										value="<%= item.PhoneNumber %>" class="form-control form-control-sm">
								</div>
								<label id="labStatus" class="col-sm-2 col-form-label text-sm-right ">Status</label>
								<div class="col-xs-2 col-sm-2">
									<input type="checkbox" name="Status" id="Status"
										class="form-control form-control-sm">
								</div>
							</div>
							<div class="form-group row">
								<div class="col-xs-2 col-sm-2"></div>
								<div class="col-xs-10 col-sm-10">

									<button type="button" id="btnSave" class="btn btn-sm btn-success" title="Save">
										<i class="fa fa-save"></i> Save
									</button>

									<button type="button" id="btnSaveAs" class="btn-sm btn-danger" title="Save as">
										<i class="far fa-clone"></i> Save as
									</button>

									&nbsp; <button type="button" id="btnUpdate" class="btn-sm btn-primary"
										title="Update">
										<i class="fa fa-save"></i> Update
									</button>

									&nbsp; <button type="button" id="btnDelete" class="btn btn-sm btn-danger"
										title="Delete">
										<i class="fas fa-trash-alt"></i> Delete
									</button>

									&nbsp; <button type="button" id="btnSearchPost" class="btn btn-sm btn-primary"
										title="Search">
										<i class="fa fa-search"></i> Search
									</button>

									&nbsp; <button type="button" id="btnSearchGet" class="btn-sm btn-warning"
										title="Search Get">
										<i class="fa fa-search"></i> Search Get
									</button>
									&nbsp; <button type="button" id="btnExport" class="btn btn-sm btn-success"
										title="Export">
										<i class="fa fa-download"></i> Export
									</button>


									<!-- <input type="button" id="btnSave" class="btn-sm btn-success" value="Save">
									&nbsp; <input type="button" id="btnSaveAs" class="btn-sm btn-danger"
										value="Save as">
									&nbsp; <input type="button" id="btnUpdate" class="btn-sm btn-primary"
										value="Update">
									&nbsp; <input type="button" id="btnDelete" class="btn-sm btn-danger" value="Delete">
									&nbsp; <input type="button" id="btnSearchPost" class="btn-sm btn-info"
										value="Search">
									&nbsp; <input type="submit" id="btnSearchGet" class="btn-sm btn-warning"
										value="Search Get">
									&nbsp; <input type="button" id="btnExport" class="btn-sm btn-success"
										value="Export"> -->
								</div>
							</div>
							<div class="form-group row">
								<div class="text-success" id="divMessage"></div>
							</div>
						</form>
						<input name="UsersIdHidden" id="UsersIdHidden" type="hidden">
						<input name="listData" id="listData" type="hidden" value="<%= itemString %>">
						<input name="sysLanguage" id="sysLanguage" type="hidden" value="<%= language %>">
						<input name="listDataCatalogue" id="listDataCatalogue" type="hidden" value="<%= catalogue %>">
					</div>
				</div>

				<!-- Role for user ===================================================================== -->
				<div class="card card-info card-outline collapsed-card">
					<div class="card-header">
						<h6 class="card-title">Role for user</h6>
						<div class="card-tools">
							<button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip"
								title="Collapse">
								<i class="fas fa-plus"></i>
							</button>
						</div>
					</div>
					<div class="card-body" style="display: none;">
						<div class="row justify-content-between">
							<label class="col-sm-4 col-form-label text-sm-right " id="labRoleName">Role Name</label>
							<div class="col-xs-2 col-sm-2" id="divRoleName">
								<div class="dropdown">
									<div id="divDropdownRoleName" class="dropdown-content">
										<input type="text" id="RoleName" name="RoleName"
											onkeyup="filterSelectBox('RoleName')" onfocus="focusDropdown('RoleName')"
											onblur="blurDropdown('RoleName')" class="form-control form-control-sm">
										<input id="IdRole" name="IdRole" type="hidden">
										<div id="DivContenRoleName" class="Divdropdown-content">
										</div>
									</div>
								</div>
							</div>
							<div class="col-xs-2 col-sm-2">
								<div class="mb-1">
									<a href="#" onclick="addRole(); return false;" class="btn btn-sm btn-info"><i
											class="fas fa-plus"></i> Add Role</a>
								</div>
							</div>
							<div class="col-xs-4 col-sm-4">
							</div>
						</div>
						<div class="row justify-content-between">
							<table id="tablesys_User_Role" class="table table-bordered table-hover btn-table mb-0">
								<thead>
									<tr>
										<th class="text-center"><label id="labIdUserRole_tb">Id</label></a></th>
										<th class="text-center"><label id="labRoleName_tb">Role Name</label></a>
										</th>
										<th class="text-center"><label id="labUserCreated_tb">User Created</label></a>
										</th>
										<th class="text-center" style="width:190px;">
											<label id="labDateTimeCreated_tb">DateTime Created</label></a>
										</th>
										<th class="text-center">Action</a></th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<th class="text-center"></a></th>
										<th class="text-center"></a></th>
										<th class="text-center"></a></th>
										<th class="text-center"></a></th>
										<th class="text-center"></a></th>
										<th class="text-center"></a></th>

									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- end Role for user===================================================================== -->



				<div class="card card-info card-outline">
					<div class="card-header">
						<h4 class="card-title">List data</h4>
						<div class="card-tools">
							<button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip"
								title="Collapse"><i class="fas fa-minus"></i></button>
						</div>
					</div>
					<div class="card-body">
						<table id="tableSys_User" class="table table-bordered table-hover btn-table mb-0">
							<thead>
								<tr>
									<th class="text-center">
										<div class="custom-control custom-checkbox">
											<input class="custom-control-input cbAll" type="checkbox" id="check-all">
											<label for="check-all" class="custom-control-label"></label>
										</div>
									</th>
									<th class="text-center"><label id="labUsersId_tb">UserId</label></a></th>
									<th class="text-center"><label id="labEmployeeCode_tb">EmployeeCode</label></a>
									</th>
									<th class="text-center"><label id="labPositionId_tb">Position</label></a></th>
									<th class="text-center"><label id="labLastName_tb">LastName</label></a></th>
									<th class="text-center"><label id="labFirstName_tb">FirstName</label></a></th>
									<th class="text-center"><label id="labUserName_tb">UserName</label></a></th>
									<th class="text-center"><label id="labEmail_tb">Email</label></a></th>
									<th class="text-center"><label id="labStatus_tb">Status</label></a></th>
									<th class="text-center">Action</a></th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-xs-1 col-sm-1">Quantity per page:</div>
					<div class="col-xs-1 col-sm-1">
						<input type="number" class="form-control form-control-sm" name="numberItemPerPage"
							id="numberItemPerPage" size="4">
					</div>
					<div class="col-xs-9 col-sm-9" id="paginationSys_User">
					</div>
				</div>
			</div>
			<script type="application/javascript">
				var language={};

				onLoadData();
				function onLoadData() {
					getLanguage();
					setUpdateButtonStatus(false)
					setInterfaceText();
					getNumberItemPerPage();
					$('#UserName').val('');
					$('#Password').val('');

					var strData=$('#listData').val();
					const arrData=JSON.parse(strData);
					if(arrData.length>0) {
						displayDataToTable(arrData);
						var paramsString=$('#params').val();
						const params=JSON.parse(paramsString);
						var linkPrefix=$('#linkPrefix').val();
						paginationHelper(params.pagination,"Sys_User",params.currentStatus,params.keyword,linkPrefix,"paginationSys_User");
					}
				}

				function displayDataToTable(datas) {
					var table=document.getElementById("tableSys_User");
					var lengthtable=table.rows.length-1;
					for(var n=lengthtable;n>0;n--) {
						table.deleteRow(n);
					}
					var length=datas.length;
					if(length<1) {
						showNoticeDanger(language.Message_NotFoundData);
						return false;
					}
					datas.forEach(function(data) {
						var row=table.insertRow(1);
						var cell0=row.insertCell(0);
						var cell1=row.insertCell(1);
						var cell2=row.insertCell(2);
						var cell3=row.insertCell(3);
						var cell4=row.insertCell(4);
						var cell5=row.insertCell(5);
						var cell6=row.insertCell(6);
						var cell7=row.insertCell(7);
						var cell8=row.insertCell(8);
						var cell9=row.insertCell(9);

						let check=` <div class="custom-control custom-checkbox"> 
						<input class="custom-control-input" type="checkbox" name="chkListData" id="${data.UsersId}" value="${data.UsersId}">
						<label for="${data.UsersId}" class="custom-control-label"></label>
						</div> `;
						cell0.innerHTML=check;
						cell1.innerHTML=data.UsersId;
						cell2.innerHTML=data.EmployeeCode;
						cell3.innerHTML=data.CompanyName+'<br />'+data.DepartmentName+'<br />'+data.PositionName;
						cell4.innerHTML=data.LastName;
						cell5.innerHTML=data.FirstName;
						cell6.innerHTML=data.UserName;
						cell7.innerHTML=data.Email;
						cell8.innerHTML=data.Status;
						let strbutton=" <a  onclick=\"getById('"+data.UsersId+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">"+
							"<i class=\"fas fa-pencil-alt\"></i>"+
							"</a> "+
							" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data.UsersId+"\" title=\"Delete\"  onclick=\"deleteById(this,"+data.UsersId+")\">";
						strbutton+=" <i class=\"fas fa-trash-alt\"></i> ";
						strbutton+=" </ button > ";
						cell9.innerHTML=strbutton;
					});
				}

				$("#numberItemPerPage").change(function() {
					setNumberItemPerPage();
				});

				function setUpdateButtonStatus(statusUpdate) {
					$('#btnSave').prop('hidden',statusUpdate);
					$('#btnUpdate').prop('hidden',!statusUpdate);
				}

				function getLanguage() {
					var languageString=$('#sysLanguage').val();
					language=JSON.parse(languageString);
				}

				function setInterfaceText() {
					$("#pageTitle").html(language.TitlePage);
					$("#labUsersId").text(language.UsersId);
					$("#labEmployeeCode").text(language.EmployeeCode);
					$("#labCompanyId").text(language.CompanyId);
					$("#labDepartmentId").text(language.DepartmentId);
					$("#labPositionId").text(language.PositionId);
					$("#labLastName").text(language.LastName);
					$("#labFirstName").text(language.FirstName);
					$("#labUserName").text(language.UserName);
					$("#labPassword").text(language.Password);
					$("#labSex").text(language.Sex);
					$("#labEmail").text(language.Email);
					$("#labPhoneNumber").text(language.PhoneNumber);
					$("#labStatus").text(language.Status);
					$("#labUsersId_tb").text(language.UsersId);
					$("#labEmployeeCode_tb").text(language.EmployeeCode);
					$("#labCompanyId_tb").text(language.CompanyId);
					$("#labDepartmentId_tb").text(language.DepartmentId);
					$("#labPositionId_tb").text(language.PositionId);
					$("#labLastName_tb").text(language.LastName);
					$("#labFirstName_tb").text(language.FirstName);
					$("#labUserName_tb").text(language.UserName);
					$("#labPassword_tb").text(language.Password);
					$("#labSex_tb").text(language.Sex);
					$("#labEmail_tb").text(language.Email);
					$("#labPhoneNumber_tb").text(language.PhoneNumber);
					$("#labStatus_tb").text(language.Status);
				}

				createDataForDropdownLists();
				function createDataForDropdownLists() {
					var strCatalogue=$('#listDataCatalogue').val();
					arrCatalogue=JSON.parse(strCatalogue);
					createDataForDropdown(arrCatalogue[0],'CompanyId','CompanyId','CompanyName','CompanyName','-- Chose --');
					createDataForDropdown(arrCatalogue[1],'DepartmentId','DepartmentId','DepartmentName','DepartmentName','-- Chose --');
					createDataForDropdown(arrCatalogue[2],'PositionId','PositionId','PositionName','PositionName','-- Chose --');
					createDataForDropdown(arrCatalogue[3],'IdRole','Id','RoleName','Name','-- Chose --');

				}

				closeAllDropdown();
				function closeAllDropdown() {
					var DivContenCompanyName=document.getElementById('DivContenCompanyName');
					DivContenCompanyName.hidden=true;

					var DivContenDepartmentName=document.getElementById('DivContenDepartmentName');
					DivContenDepartmentName.hidden=true;

					var DivContenPositionName=document.getElementById('DivContenPositionName');
					DivContenPositionName.hidden=true;

					var DivContenRoleName=document.getElementById('DivContenRoleName');
					DivContenRoleName.hidden=true;

				}


				function addRole() {
					let UsersId=$('#UsersId').val();
					if(!parseInt(UsersId)) {
						var message=language.Message_Invalid_HaveNotSelectedUser; //You have not selected a user. Please select a user
						alert(message);
						return false;
					}
					let IdRole=$('#IdRole').val();
					if(!parseInt(IdRole)) {
						var message=language.Message_Invalid_HaveNotSelectedRole; //Please choose a role
						alert(message);
						return false;
					}
					var link=$('#linkPrefix').val()+'addRole';
					let data={
						'UsersId': UsersId,
						'IdRole': IdRole,
					}
					$.ajax({
						type: 'post',
						url: link,
						data: data,
						dataType: "json",
						success: function(response) {
							var success=response.success;
							var result=response.data;
							if((success=='false')||(success==false))
								showNoticeDanger(language.Message_AddNewRoleError);
							else if((success!=true)&&(success!='true'))
								showNoticeDanger(result.message);
							else {
								insertRowUserRole(result.data);
							}
						},
						failure: function(response) {
							showErrorMessageSave(response,language.Message_AddNewError);
						},
						error: function(response) {
							showErrorMessageSave(response,language.Message_AddNewError);
						},
					});
				}

				function insertRowUserRole(data) {
					showNoticeSuccess(language.Message_AddNewRoleSuccess);
					var table=document.getElementById("tablesys_User_Role");
					var row=table.insertRow(1);
					var cell0=row.insertCell(0);
					var cell1=row.insertCell(1);
					var cell2=row.insertCell(2);
					var cell3=row.insertCell(3);
					var cell4=row.insertCell(4);

					cell0.innerHTML=data.Id;
					cell1.innerHTML=$('#RoleName').val();
					cell2.innerHTML=data.User_Name_Created;
					cell3.innerHTML=dateToStringMMMHH(data.DateTime_Created,'-');

					let strbutton=" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-idUserRole=\""+data.Id+"\" title=\"Delete\"  onclick=\"deleteUserRoleById(this,"+data.Id+")\">";
					strbutton+=" <i class=\"fas fa-trash-alt\"></i> ";
					strbutton+=" </ button > ";
					cell4.innerHTML=strbutton;
				}

				function getById(Id) {
					var link=$('#linkPrefix').val()+'getById/'+Id;
					$.ajax({
						type: 'GET',
						url: link,
						dataType: "json",
						success: function(resultdata) {
							var success=resultdata.success;
							if(success==true) {
								showDataToForm(resultdata.data);
								displayUserRoleToTable(resultdata.userRole);
							}
						},
						failure: function(response) {
							alert(language.Message_GetItemByIdError);
						},
						error: function(response) {
							alert(language.Message_GetItemByIdError);
						},
					});
				}

				function displayUserRoleToTable(datas) {
					var table=document.getElementById("tablesys_User_Role");
					var lengthtable=table.rows.length-1;
					for(var n=lengthtable;n>0;n--) {
						table.deleteRow(n);
					}
					var length=datas.length;

					datas.forEach(function(data) {
						var row=table.insertRow(1);
						var cell0=row.insertCell(0);
						var cell1=row.insertCell(1);
						var cell2=row.insertCell(2);
						var cell3=row.insertCell(3);
						var cell4=row.insertCell(4);

						cell0.innerHTML=data.Id;
						cell1.innerHTML=data.RoleName;
						cell2.innerHTML=data.User_Name_Created;
						cell3.innerHTML=dateToStringMMMHH(data.DateTime_Created,'-');

						let strbutton=" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-idUserRole=\""+data.Id+"\" title=\"Delete\"  onclick=\"deleteUserRoleById(this,"+data.Id+")\">";
						strbutton+=" <i class=\"fas fa-trash-alt\"></i> ";
						strbutton+=" </ button > ";
						cell4.innerHTML=strbutton;
					});
				}

				function deleteUserRoleById(row,IdObject) {
					let message=language.Message_DoYouWantToDeleteRoleById+' '+IdObject+'?';
					var answer=confirm(message)
					if(!answer) {return false;}
					let data={
						'Id': IdObject
					};
					var link=$('#linkPrefix').val()+'deleteUserRoleById';
					$.ajax({
						type: 'delete',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							var success=resultdata.success;
							var message=resultdata.message;
							var notice={};
							if((success=='true')||(success==true)) {
								showNoticeSuccess(language.Message_DeleteRoleSuccess);
								var i=row.parentNode.parentNode.rowIndex;
								document.getElementById("tablesys_User_Role").deleteRow(i);
								return true;
							}
							else if(message.length>10) {
								showNoticeDanger(message);
								return false;
							}
							else {
								showNoticeDanger(language.Message_DeleteFail);
								return false;
							}
						},
						failure: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						},
						error: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						}
					});
				}

				function showDataToForm(data) {
					try {
						window.scrollTo(0,120);

						setUpdateButtonStatus(true);
						$('#UsersIdHidden').val(data.UsersId);
						$('#UsersId').val(data.UsersId);
						$('#EmployeeCode').val(data.EmployeeCode);
						$('#CompanyId').val(data.CompanyId);
						$('#CompanyName').val(data.CompanyName);
						$('#DepartmentId').val(data.DepartmentId);
						$('#DepartmentName').val(data.DepartmentName);
						$('#PositionId').val(data.PositionId);
						$('#PositionName').val(data.PositionName);
						$('#LastName').val(data.LastName);
						$('#FirstName').val(data.FirstName);
						$('#UserName').val(data.UserName);
						$('#Sex').val(data.Sex);
						$('#Email').val(data.Email);
						$('#PhoneNumber').val(data.PhoneNumber);
						if((data.Status=="true")||(data.Status==true)||(data.Status=="active")||(data.Status=="yes")||(data.Status=="1"))
							$("#Status").prop("checked",true);
						else $("#Status").prop("checked",false);
					}
					catch(error) {}
				}

				function clearForm() {
					try {
						$('#UsersIdHidden').val('');
						setUpdateButtonStatus(false)
						$('#UsersId').val('');
						$('#EmployeeCode').val('');
						$('#CompanyId').val('');
						$('#CompanyName').val('');
						$('#DepartmentId').val('');
						$('#DepartmentName').val('');
						$('#PositionId').val('');
						$('#PositionName').val('');
						$('#LastName').val('');
						$('#FirstName').val('');
						$('#UserName').val('');
						$('#Password').val('');
						$('#Sex').val('');
						$('#Email').val('');
						$('#PhoneNumber').val('');
						$("#Status").prop("checked",false);
					}
					catch(error) {}
				}

				$('#btnSearchPost').click(function() {
					$(this).prop('disabled',true);
					getContentPages(1);
				});

				function getContentPages(page) {
					var sortStorage=getSortType(linkPrefix);
					let data={
						'Page': page,
						'EmployeeCode': $('#EmployeeCode').val(),
						'LastName': $('#LastName').val(),
						'FirstName': $('#FirstName').val(),
						'UserName': $('#UserName').val(),
						'Sex': $('#Sex').val(),
						'Email': $('#Email').val(),
						'PhoneNumber': $('#PhoneNumber').val(),
						sortColumn: sortStorage.sortColumn,
						sortType: sortStorage.sortType,
						numberItemPerPage: $('#numberItemPerPage').val()
					}
					var link=$('#linkPrefix').val()+'search';
					$.ajax({
						type: 'POST',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {	
							console.log(resultdata);						
							$('#btnSearchPost').prop('disabled',false);
							let result=resultdata.data;
							displayDataToTable(result);
							var linkPrefix=$('#linkPrefix').val();
							let params=resultdata.params;
							paginationHelper(params.pagination,"Sys_User","","",linkPrefix,"paginationSys_User");

							if(params.pagination.totalItems>0) {
								var message=language.Message_Find+params.pagination.totalItems+language.Message_Words_records;
								showNoticeSuccess(message);
							}
						},
						failure: function(response) {
							$('#btnSearchPost').prop('disabled',false);
							showNoticeDanger('Search Error');
						},
						error: function(response) {
							$('#btnSearchPost').prop('disabled',false);
							showNoticeDanger('Search Error');
						}
					});
					$('#btnSearchPost').prop('disabled',false);
				}

				$('#btnSave').click(function() {
					$(this).prop('disabled',true);
					saveInsert();
				});

				$('#btnSaveAs').click(function() {
					$(this).prop('disabled',true);
					$('#UsersIdHidden').val('');
					$('#UsersId').val('');
					saveInsert();
				});

				function getDataForm() {
					if(($('#EmployeeCode').val().length<3)||($('#EmployeeCode').val().length>15)) {
						var message=formatMessage(language.EmployeeCode+": "+language.Message_Invalid_EmployeeCode,'1','15');
						alert(message);
						return false;
					}
					if(($('#CompanyId').val()<0)||($('#CompanyId').val()>9223372036854775807)) {
						var message=formatMessage(language.CompanyId+": "+language.Message_Invalid_CompanyId,'0','9223372036854775807');
						alert(message);
						return false;
					}
					if(($('#DepartmentId').val()<0)||($('#DepartmentId').val()>9223372036854775807)) {
						var message=formatMessage(language.DepartmentId+": "+language.Message_Invalid_DepartmentId,'0','9223372036854775807');
						alert(message);
						return false;
					}
					if(($('#PositionId').val()<0)||($('#PositionId').val()>9223372036854775807)) {
						var message=formatMessage(language.PositionId+": "+language.Message_Invalid_PositionId,'0','9223372036854775807');
						alert(message);
						return false;
					}
					if(($('#LastName').val().length<1)||($('#LastName').val().length>30)) {
						var message=formatMessage(language.LastName+": "+language.Message_Invalid_LastName,'1','30');
						alert(message);
						return false;
					}
					if(($('#FirstName').val().length<3)||($('#FirstName').val().length>30)) {
						var message=formatMessage(language.FirstName+": "+language.Message_Invalid_FirstName,'1','30');
						alert(message);
						return false;
					}
					if(($('#UserName').val().length<3)||($('#UserName').val().length>20)) {
						var message=formatMessage(language.UserName+": "+language.Message_Invalid_UserName,'3','20');
						alert(message);
						return false;
					}


					let Password=$('#Password').val();
					Password=replaceAll(Password,' ','');
					Password=hex_sha1(Password);

					let UserName=$('#UserName').val();
					UserName=replaceAll(UserName,' ','');
					UserName=UserName.toLowerCase();
					let UserName_Encrypted=hex_sha1(UserName);

					return {
						'UsersIdHidden': $('#UsersIdHidden').val(),
						'UsersId': $('#UsersId').val(),
						'EmployeeCode': $('#EmployeeCode').val(),
						'CompanyId': $('#CompanyId').val(),
						'DepartmentId': $('#DepartmentId').val(),
						'PositionId': $('#PositionId').val(),
						'LastName': $('#LastName').val(),
						'FirstName': $('#FirstName').val(),
						'UserName': UserName,
						'UserName_Encrypted': UserName_Encrypted,
						'Password': Password,
						'Sex': $('#Sex').val(),
						'Email': $('#Email').val(),
						'PhoneNumber': $('#PhoneNumber').val(),
						'Status': $('#Status').is(":checked"),
					}
				}


				function saveInsert() {
					let data=getDataForm();
					if(($('#Password').val().length<8)) {
						var message=formatMessage(language.Password+": "+language.Message_Invalid_Password,'8','8');
						alert(message);
						return false;
					}


					if(data==false) {
						$('#btnSave').prop('disabled',false);
						return false;
					}
					var link=$('#linkPrefix').val()+'save';
					$.ajax({
						type: 'post',
						url: link,
						data: data,
						dataType: "json",
						success: function(response) {
							var success=response.success;
							var result=response.data;
							if((success=='false')||(success==false))
								showNoticeDanger(language.Message_AddNewError);
							else if((success!=true)&&(success!='true'))
								showNoticeDanger(result.message);
							else {
								insertRow(result.data);
								clearForm();
							}
						},
						failure: function(response) {
							showErrorMessageSave(response,language.Message_AddNewError);
						},
						error: function(response) {
							showErrorMessageSave(response,language.Message_AddNewError);
						},
					});
					$('#btnSave').prop('disabled',false);
				}

				function insertRow(data) {
					showNoticeSuccess(language.Message_AddNewSuccess);
					var table=document.getElementById("tableSys_User");
					var row=table.insertRow(1);
					var cell0=row.insertCell(0);
					var cell1=row.insertCell(1);
					var cell2=row.insertCell(2);
					var cell3=row.insertCell(3);
					var cell4=row.insertCell(4);
					var cell5=row.insertCell(5);
					var cell6=row.insertCell(6);
					var cell7=row.insertCell(7);
					var cell8=row.insertCell(8);
					var cell9=row.insertCell(9);
					let check=`<div class="custom-control custom-checkbox"> 
<input class="custom-control-input" type="checkbox" name="chkListData" id="${data.UsersId}" value="${data.UsersId}">
<label for="${data.UsersId}" class="custom-control-label"></label>
</div>`;
					cell0.innerHTML=check;
					cell1.innerHTML=data.UsersId;
					cell2.innerHTML=data.EmployeeCode;
					let Position="";
					if(data.CompanyId==$('#CompanyId').val()) {
						Position=$('#CompanyName').val()+"<br />";
					}

					if(data.DepartmentId==$('#DepartmentId').val()) {
						Position+=$('#DepartmentName').val()+"<br />";
					}

					if(data.PositionId==$('#PositionId').val()) {
						Position+=$('#PositionName').val();
					}
					cell3.innerHTML=Position;

					cell4.innerHTML=data.LastName;
					cell5.innerHTML=data.FirstName;
					cell6.innerHTML=data.UserName;
					cell7.innerHTML=data.Email;
					cell8.innerHTML=data.Status;
					let strbutton=" <a  onclick=\"getById('"+data.UsersId+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">"+
						"<i class=\"fas fa-pencil-alt\"></i>"+
						"</a> "+
						" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data.UsersId+"\" title=\"Delete\"  onclick=\"deleteById(this,"+data.UsersId+")\">";
					strbutton+=" <i class=\"fas fa-trash-alt\"></i> ";
					strbutton+=" </ button > ";
					cell9.innerHTML=strbutton;
				}

				$('#btnUpdate').click(function() {
					$(this).prop('disabled',true);
					saveUpdate();
				});

				function saveUpdate() {
					let data=getDataForm();
					if(data==false) {
						$('#btnUpdate').prop('disabled',false);
						return false;
					}
					if(data.UsersIdHidden=="") {
						$('#btnUpdate').prop('disabled',false);
						showNoticeDanger(language.Message_HaveNotSelectedItemUpdate);
						return false;
					}
					var link=$('#linkPrefix').val()+'update';
					$.ajax({
						type: 'put',
						url: link,
						data: data,
						dataType: "json",
						success: function(response) {
							var success=response.success;
							var result=response.data;
							if((success=='false')||(success==false)) {
								showNoticeDanger(language.Message_UpdateError);
								return false;
							}
							else if((success!=true)&&(success!='true')) {
								showNoticeDanger(result.message);
								return false;
							}
							else {
								updateRow(result.data);
								clearForm();
							}
						},
						failure: function(response) {
							showErrorMessageSave(response,language.Message_UpdateError);
						},
						error: function(response) {
							showErrorMessageSave(response,language.Message_UpdateError);
						}
					});
					$('#btnUpdate').prop('disabled',false);
				}

				function updateRow(data) {
					showNoticeSuccess(language.Message_UpdateSuccess);
					var row=$("#tableSys_User button[data-id='"+data.UsersId+"']").parents("tr")[0];
					var tr="<tr>"+
						"<td class=\"text-center\">"+
						"<div class=\"custom-control custom-checkbox\">"+
						"<input class=\"custom-control-input\" type=\"checkbox\" name=\"chkListData\" id=\""+data.UsersId+"\" value=\""+data.UsersId+"\"> "+
						"<label for=\""+data.UsersId+"\" class=\"custom-control-label\"></label> "+
						"</div>"+
						"</td>";
					tr+="<td class=\"text-center\">"+data.UsersId+"</td>";
					tr+="<td class=\"text-center\">"+data.EmployeeCode+"</td>";

					let Position="";
					Position=$('#CompanyName').val()+"<br />";
					Position+=$('#DepartmentName').val()+"<br />";
					Position+=$('#PositionName').val();
					tr+="<td class=\"text-center\">"+Position+"</td>";
					tr+="<td class=\"text-center\">"+data.LastName+"</td>";
					tr+="<td class=\"text-center\">"+data.FirstName+"</td>";
					tr+="<td class=\"text-center\">"+data.UserName+"</td>";
					tr+="<td class=\"text-center\">"+data.Email+"</td>";
					tr+="<td class=\"text-center\">"+data.Status+"</td>";
					tr+="<td class=\"text-center\">"+
						" <a  onclick=\"getById('"+data.UsersId+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">"+
						" <i class=\"fas fa-pencil-alt\"></i>"+
						" </a>"+
						" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data.UsersId+"\" title=\"Delete\"  onclick=\"deleteById(this,'"+data.UsersId+"')\">"+
						" <i class=\"fas fa-trash-alt\"></i> "+
						" </button> "+
						" </td>"+
						" </tr>";
					$(row).after(tr);
					$(row).remove();
				}
				function deleteById(row,IdObject) {
					let message=language.Message_DoYouWantToDeleteById+' '+IdObject+'?';
					var answer=confirm(message)
					if(!answer) {return false;}
					let data={
						'UsersId': IdObject
					};
					var link=$('#linkPrefix').val()+'deleteById';
					$.ajax({
						type: 'delete',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							var success=resultdata.success;
							var message=resultdata.message;
							var notice={};
							if((success=='true')||(success==true)) {
								showNoticeSuccess(language.Message_DeleteSuccess);
								var i=row.parentNode.parentNode.rowIndex;
								document.getElementById("tableSys_User").deleteRow(i);
								return true;
							}
							else if(message.length>10) {
								showNoticeDanger(message);
								return false;
							}
							else {
								showNoticeDanger(language.Message_DeleteFail);
								return false;
							}
						},
						failure: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						},
						error: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						}
					});
				}

				$('#btnDelete').click(function() {
					$(this).prop('disabled',true);
					deleteList();
					$(this).prop('disabled',false);
				});
				function deleteList() {
					var arrayId=[];
					var listId=" ";
					$("input:checkbox[name=chkListData]:checked").each(function() {
						arrayId.push($(this).val());
						listId+=$(this).val()+' ';
					});
					let message=language.Message_DoYouWantToDeleteInTheList+' '+listId+'?';
					var answer=confirm(message)
					if(!answer) {return false;}
					let data={arrayId};
					var link=$('#linkPrefix').val()+'deleteList';
					$.ajax({
						type: 'delete',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							var result=resultdata.result;
							var success=result.success;
							var message=result.message;
							if((success=='true')||(success==true)) {
								let deleteSuccess=result.deleteSuccess;
								let deleteError=result.deleteError;
								if(deleteSuccess.length>0) {
									let message=language.Message_DeleteSuccess;
									message+=" "+deleteSuccess.toString();
									if(deleteError.length>0) {
										message+=" \n"+language.Message_DeleteFail+" "+deleteError.toString();
									}
									showNoticeSuccess(message);
									deleteRows(arrayId,"tableSys_User");
									return true;
								}
								else if(deleteError.length>0) {
									let message=language.Message_DeleteFail+" "+deleteError.toString();
									showNoticeDanger(message);
								}
								else {
									showNoticeDanger(language.Message_DeleteFail);
								}
							}
							else if((success=='false')||(success==false)) {
								showNoticeDanger(language.Message_DeleteFail);
								return false;
							}
						},
						failure: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						},
						error: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						}
					});
				}

				$('#btnExport').click(function() {
					$(this).prop('disabled',true);
					exportData();
					$(this).prop('disabled',false);
				});

				function exportData() {
					let data={
						'EmployeeCode': $('#EmployeeCode').val(),
						'LastName': $('#LastName').val(),
						'FirstName': $('#FirstName').val(),
						'UserName': $('#UserName').val(),
						'Password': $('#Password').val(),
						'Sex': $('#Sex').val(),
						'Email': $('#Email').val(),
						'PhoneNumber': $('#PhoneNumber').val(),
					}
					var link=$('#linkPrefix').val()+'exportData';
					$.ajax({
						type: 'post',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							$('#btnExport').prop('disabled',false);
							let result=resultdata.result;
							showNoticeSuccess(language.Message_CompletedGetData);
							ExportToExcel(result);
						},
						failure: function(response) {
							$('#btnExport').prop('disabled',false);
							showNoticeDanger('Export Error');
						},
						error: function(response) {
							$('#btnExport').prop('disabled',false);
							showNoticeDanger('Export Error');
						}
					});
					$('#btnExport').prop('disabled',false);
				}

				function ExportToExcel(datas) {
					let itemCount=datas.length;
					if(itemCount>1000) {
						showNoticeDanger(language.Message_WarningWhenExportingDataTooMuch);
					}
					if(itemCount<1) {
						showNoticeDanger(language.Message_NotFoundData);
					}
					var strTable='<style type="text/css">';
					strTable+=' .Border { ';
					strTable+='         color: windowtext; ';
					strTable+='         font-size: 11.0pt; ';
					strTable+='         word-break:break-all;';
					strTable+='         font-style: normal; ';
					strTable+='         text-decoration: none; ';
					strTable+='         font-family: "Times New Roman", serif; ';
					strTable+='         text-align: left; ';
					strTable+='         vertical-align: bottom;';
					strTable+='         border-left: .5pt solid windowtext; ';
					strTable+='         border-right: .5pt solid windowtext; ';
					strTable+='         border-top: .5pt solid windowtext; ';
					strTable+='         border-bottom: .5pt solid windowtext; ';
					strTable+='         padding-left: 1px; ';
					strTable+='         padding-right: 1px; ';
					strTable+='         padding-top: 1px; ';
					strTable+='     } ';

					strTable+=' .BorderHeader { ';
					strTable+='        color: white; ';
					strTable+='         background-color:#0026ff; ';
					strTable+='        font-size: 11.0pt; ';
					strTable+='        text-align: center; ';
					strTable+='        font-style: normal; ';
					strTable+='        text-decoration: none; ';
					strTable+='        font-family: "Times New Roman", serif; ';
					strTable+='        vertical-align: bottom;';
					strTable+='        border-left: .5pt solid windowtext; ';
					strTable+='        border-right: .5pt solid windowtext; ';
					strTable+='        border-top: .5pt solid windowtext; ';
					strTable+='        border-bottom: .5pt solid windowtext; ';
					strTable+='        padding-left: 1px; ';
					strTable+='        padding-right: 1px; ';
					strTable+='        padding-top: 1px; ';
					strTable+='     } ';
					strTable+='  </style> ';
					strTable+=' <table id="testTable"  border="1" frame="hsides" rules="groups" summary="Code page support in different versions of MS Windows."> ';
					strTable+='<tr class="BorderHeader" style="background - color:#0026ff; color:#fff"> ';
					strTable+='<th class="BorderHeader" >Order</th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> UsersId </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> EmployeeCode </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> CompanyId </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> DepartmentId </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> PositionId </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> LastName </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> FirstName </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> UserName </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Password </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Sex </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Email </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> PhoneNumber </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Status </th> ';
					strTable+='</tr> ';
					var n=0;
					var currentRow=4;
					for(var i=0;i<itemCount;i++) {
						var vTemp=datas[i];
						currentRow+=1;
						n+=1;
						strTable+='<tr >';
						strTable+='<th class="Border" > '+n+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.UsersId+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.EmployeeCode+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.CompanyId+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.DepartmentId+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.PositionId+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.LastName+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.FirstName+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.UserName+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.Password+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.Sex+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.Email+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.PhoneNumber+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.Status+' </th> ';
						strTable+='</tr>';
					}
					strTable+=' </table> ';
					ExportHtmlToExcel(strTable,'Sys_User');
					showNoticeSuccess(language.Message_ExportSuccess);
				}

			</script>